DROP TABLE MOVE IF EXISTS;
DROP TABLE ACTION IF EXISTS;
DROP TABLE CARD IF EXISTS;
DROP TABLE ROBOT IF EXISTS;
DROP TABLE TARGET IF EXISTS;
DROP TABLE SQUARE IF EXISTS;
DROP TABLE GAME IF EXISTS;
DROP TABLE BOARD IF EXISTS;
DROP TABLE ACCOUNT IF EXISTS;

CREATE TABLE ACCOUNT (
	USERNAME VARCHAR(32) NOT NULL PRIMARY KEY,
	PASSWORD VARCHAR(32) NOT NULL
);

CREATE TABLE BOARD (
	ID INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
	TYPE VARCHAR(5) NOT NULL,
	SIZE_X INTEGER NOT NULL,
	SIZE_Y INTEGER NOT NULL
);

CREATE TABLE GAME (
	ID INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
	OWNER VARCHAR(30) NOT NULL,
	NAME VARCHAR(32) NOT NULL,
	BOARD_ID INTEGER NOT NULL,
	FOREIGN KEY (OWNER) REFERENCES ACCOUNT(USERNAME),
	FOREIGN KEY (BOARD_ID) REFERENCES BOARD(ID)
);

CREATE TABLE SQUARE (
	BOARD_ID INTEGER NOT NULL,
	X INTEGER NOT NULL,
	Y INTEGER NOT NULL,
	CLASS VARCHAR(128) NOT NULL,
	ARGS VARCHAR(64) NULL,
	PRIMARY KEY (BOARD_ID, X, Y)
);

CREATE TABLE TARGET (
	BOARD_ID INTEGER NOT NULL,
	TARGET_NB INTEGER NOT NULL,
	X INTEGER NOT NULL,
	Y INTEGER NOT NULL,
	PRIMARY KEY (BOARD_ID, TARGET_NB),
	FOREIGN KEY (BOARD_ID,X,Y) REFERENCES SQUARE(BOARD_ID,X,Y)
);

CREATE TABLE ROBOT (
	NUMBER INTEGER NOT NULL,
	GAME_ID INTEGER NOT NULL,
	X INTEGER NOT NULL,
	Y INTEGER NOT NULL,
	DIRECTION VARCHAR(5) NOT NULL,
	HEALTH INTEGER NOT NULL,
	GHOST BOOLEAN NOT NULL,
	USER_NAME VARCHAR(32) NULL,
	PRIMARY KEY (NUMBER, GAME_ID),
	FOREIGN KEY (GAME_ID) REFERENCES GAME(ID)
);

CREATE TABLE CARD (
	GAME_ID INTEGER NOT NULL,
	RAPIDITY INTEGER NOT NULL,
	TRANSLATION INTEGER NOT NULL,
	ROTATION INTEGER NOT NULL,
	ROBOT_NB INTEGER NULL,
	HAND_INDEX INTEGER NULL,
	DISCARDED BOOLEAN NOT NULL,
	PRIMARY KEY (GAME_ID, RAPIDITY),
	FOREIGN KEY (GAME_ID) REFERENCES GAME(ID),
	FOREIGN KEY (GAME_ID,ROBOT_NB) REFERENCES ROBOT(GAME_ID,NUMBER)
);

CREATE TABLE ACTION (
	GAME_ID INTEGER NOT NULL,
	ROUND_NB INTEGER NOT NULL,
	STAGE_NB INTEGER NOT NULL,
	ACTION_NB INTEGER NOT NULL,
	CARD_RAPIDITY INTEGER NULL,
	TYPE VARCHAR(32) NOT NULL,
	SQUARE_X INTEGER NULL,
	SQUARE_Y INTEGER NULL,
	PRIMARY KEY (GAME_ID, ROUND_NB, STAGE_NB, ACTION_NB),
	FOREIGN KEY (GAME_ID) REFERENCES GAME(ID),
	FOREIGN KEY (GAME_ID, CARD_RAPIDITY) REFERENCES CARD(GAME_ID, RAPIDITY)
	-- No foreign key for SQUARE because link is not on only one table
);

CREATE TABLE MOVE (
	GAME_ID INTEGER NOT NULL,
	ROUND_NB INTEGER NOT NULL,
	STAGE_NB INTEGER NOT NULL,
	ACTION_NB INTEGER NOT NULL,
	STEP_NB INTEGER NOT NULL,
	MOVE_NB INTEGER NOT NULL,
	ROBOT_NB INTEGER NOT NULL,
	TYPE VARCHAR(32) NOT NULL,
	ARGS VARCHAR(128) NOT NULL,
	PRIMARY KEY (GAME_ID, ROUND_NB, STAGE_NB, ACTION_NB, STEP_NB, MOVE_NB),
	FOREIGN KEY (GAME_ID, ROUND_NB, STAGE_NB, ACTION_NB) REFERENCES ACTION(GAME_ID, ROUND_NB, STAGE_NB, ACTION_NB)
);

INSERT INTO ACCOUNT(USERNAME,PASSWORD) VALUES('mrprez', '135db287cad29417f6cdea20b7e359a3');
INSERT INTO BOARD(TYPE,SIZE_X,SIZE_Y) VALUES ('Game', 16, 4);
INSERT INTO BOARD(TYPE,SIZE_X,SIZE_Y) VALUES ('Game', 32, 4);
INSERT INTO GAME(OWNER,NAME,BOARD_ID) VALUES ('mrprez', 'test0', 0);
INSERT INTO GAME(OWNER,NAME,BOARD_ID) VALUES ('mrprez', 'test1', 1);


INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,0,0,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,0,1,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,0,2,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,0,3,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,1,0,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,1,1,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,1,2,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,1,3,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,2,0,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,2,1,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,2,2,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,2,3,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,3,0,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,3,1,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,3,2,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,3,3,'com.mrprez.roborally.model.square.EmptySquare',null);

INSERT INTO TARGET(BOARD_ID,TARGET_NB,X,Y) VALUES (0,0,1,1);
INSERT INTO TARGET(BOARD_ID,TARGET_NB,X,Y) VALUES (0,1,3,3);
INSERT INTO TARGET(BOARD_ID,TARGET_NB,X,Y) VALUES (0,2,1,2);
INSERT INTO TARGET(BOARD_ID,TARGET_NB,X,Y) VALUES (0,3,0,0);

INSERT INTO ROBOT(NUMBER,GAME_ID,X,Y,DIRECTION,HEALTH,GHOST,USER_NAME) VALUES (0,0,1,1,'UP'   ,9,false,'mrprez');
INSERT INTO ROBOT(NUMBER,GAME_ID,X,Y,DIRECTION,HEALTH,GHOST,USER_NAME) VALUES (1,0,2,1,'RIGHT',9,false,null);
INSERT INTO ROBOT(NUMBER,GAME_ID,X,Y,DIRECTION,HEALTH,GHOST,USER_NAME) VALUES (2,0,2,2,'LEFT' ,9,true ,null);

INSERT INTO CARD(GAME_ID,RAPIDITY,TRANSLATION,ROTATION,ROBOT_NB,HAND_INDEX,DISCARDED) VALUES (0,1, 1, 0,0,0,false);
INSERT INTO CARD(GAME_ID,RAPIDITY,TRANSLATION,ROTATION,ROBOT_NB,HAND_INDEX,DISCARDED) VALUES (0,2, 2, 0,0,1,false);
INSERT INTO CARD(GAME_ID,RAPIDITY,TRANSLATION,ROTATION,ROBOT_NB,HAND_INDEX,DISCARDED) VALUES (0,3, 3, 0,0,2,false);
INSERT INTO CARD(GAME_ID,RAPIDITY,TRANSLATION,ROTATION,ROBOT_NB,HAND_INDEX,DISCARDED) VALUES (0,4,-1, 0,0,3,false);
INSERT INTO CARD(GAME_ID,RAPIDITY,TRANSLATION,ROTATION,ROBOT_NB,HAND_INDEX,DISCARDED) VALUES (0,5, 0, 1,0,4,false);
INSERT INTO CARD(GAME_ID,RAPIDITY,TRANSLATION,ROTATION,ROBOT_NB,HAND_INDEX,DISCARDED) VALUES (0,6, 0, 2,0,5,false);
INSERT INTO CARD(GAME_ID,RAPIDITY,TRANSLATION,ROTATION,ROBOT_NB,HAND_INDEX,DISCARDED) VALUES (0,7, 0,-1,0,6,false);
INSERT INTO CARD(GAME_ID,RAPIDITY,TRANSLATION,ROTATION,ROBOT_NB,HAND_INDEX,DISCARDED) VALUES (0,8, 1, 0,0,7,false);
INSERT INTO CARD(GAME_ID,RAPIDITY,TRANSLATION,ROTATION,ROBOT_NB,HAND_INDEX,DISCARDED) VALUES (0,9, 2, 0,0,8,false);

INSERT INTO ACTION(GAME_ID,ROUND_NB,STAGE_NB,ACTION_NB,TYPE,CARD_RAPIDITY,SQUARE_X,SQUARE_Y) VALUES (0,0,0,0,'CARD',1,null,null);
INSERT INTO ACTION(GAME_ID,ROUND_NB,STAGE_NB,ACTION_NB,TYPE,CARD_RAPIDITY,SQUARE_X,SQUARE_Y) VALUES (0,0,0,1,'CARD',2,null,null);
INSERT INTO ACTION(GAME_ID,ROUND_NB,STAGE_NB,ACTION_NB,TYPE,CARD_RAPIDITY,SQUARE_X,SQUARE_Y) VALUES (0,0,0,2,'CARD',3,null,null);
INSERT INTO ACTION(GAME_ID,ROUND_NB,STAGE_NB,ACTION_NB,TYPE,CARD_RAPIDITY,SQUARE_X,SQUARE_Y) VALUES (0,0,0,3,'CARD',4,null,null);
INSERT INTO ACTION(GAME_ID,ROUND_NB,STAGE_NB,ACTION_NB,TYPE,CARD_RAPIDITY,SQUARE_X,SQUARE_Y) VALUES (0,0,0,4,'CARD',5,null,null);
INSERT INTO ACTION(GAME_ID,ROUND_NB,STAGE_NB,ACTION_NB,TYPE,CARD_RAPIDITY,SQUARE_X,SQUARE_Y) VALUES (0,0,0,5,'CARD',6,null,null);

-- ROBOT 0 tourne à droite
INSERT INTO MOVE(GAME_ID,ROUND_NB,STAGE_NB,ACTION_NB,STEP_NB,MOVE_NB,ROBOT_NB,TYPE,ARGS) VALUES (0,0,0, 0,0,0,0,'ROTATION'   ,'1');
-- ROBOT 0 pousse ROBOT 1 d'un cran
INSERT INTO MOVE(GAME_ID,ROUND_NB,STAGE_NB,ACTION_NB,STEP_NB,MOVE_NB,ROBOT_NB,TYPE,ARGS) VALUES (0,0,0, 1,0,0,0,'TRANSLATION','RIGHT');
INSERT INTO MOVE(GAME_ID,ROUND_NB,STAGE_NB,ACTION_NB,STEP_NB,MOVE_NB,ROBOT_NB,TYPE,ARGS) VALUES (0,0,0, 1,0,1,1,'TRANSLATION','RIGHT');
-- ROBOT 1 tourne à droite
INSERT INTO MOVE(GAME_ID,ROUND_NB,STAGE_NB,ACTION_NB,STEP_NB,MOVE_NB,ROBOT_NB,TYPE,ARGS) VALUES (0,0,0, 2,0,0,1,'ROTATION'   ,'1');
-- ROBOT 1 tourne à gauche en avancant
INSERT INTO MOVE(GAME_ID,ROUND_NB,STAGE_NB,ACTION_NB,STEP_NB,MOVE_NB,ROBOT_NB,TYPE,ARGS) VALUES (0,0,0, 3,0,0,1,'TRANSLATION','DOWN');
INSERT INTO MOVE(GAME_ID,ROUND_NB,STAGE_NB,ACTION_NB,STEP_NB,MOVE_NB,ROBOT_NB,TYPE,ARGS) VALUES (0,0,0, 3,0,1,1,'ROTATION'   ,'-1');
-- ROBOT 2 avance de 2 cases
INSERT INTO MOVE(GAME_ID,ROUND_NB,STAGE_NB,ACTION_NB,STEP_NB,MOVE_NB,ROBOT_NB,TYPE,ARGS) VALUES (0,0,0, 4,0,0,2,'TRANSLATION','LEFT');
INSERT INTO MOVE(GAME_ID,ROUND_NB,STAGE_NB,ACTION_NB,STEP_NB,MOVE_NB,ROBOT_NB,TYPE,ARGS) VALUES (0,0,0, 4,1,0,2,'TRANSLATION','LEFT');
-- ROBOT 1 tente d'avancer mais échoue
INSERT INTO MOVE(GAME_ID,ROUND_NB,STAGE_NB,ACTION_NB,STEP_NB,MOVE_NB,ROBOT_NB,TYPE,ARGS) VALUES (0,0,0, 5,0,0,1,'FAILED_TRANSLATION','RIGHT');


INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 4,0,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 5,0,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 6,0,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 7,0,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 8,0,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 9,0,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,10,0,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,11,0,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,12,0,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,13,0,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,14,0,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,15,0,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 4,1,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 5,1,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 6,1,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 7,1,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 8,1,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 9,1,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,10,1,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,11,1,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,12,1,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,13,1,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,14,1,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,15,1,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 4,2,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 5,2,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 6,2,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 7,2,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 8,2,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 9,2,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,10,2,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,11,2,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,12,2,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,13,2,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,14,2,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,15,2,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 4,3,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 5,3,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 6,3,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 7,3,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 8,3,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0, 9,3,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,10,3,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,11,3,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,12,3,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,13,3,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,14,3,'com.mrprez.roborally.model.square.EmptySquare',null);
INSERT INTO SQUARE(BOARD_ID,X,Y,CLASS,ARGS) VALUES (0,15,3,'com.mrprez.roborally.model.square.EmptySquare',null);

